<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.zsyk.crm.manage.mapper.SysRuleStrategyMapper">
  <resultMap id="BaseResultMap" type="cn.com.zsyk.crm.manage.entity.SysRuleStrategy">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="STRATEGY_ID" jdbcType="CHAR" property="strategyId" />
    <result column="STRATEGY_CODE" jdbcType="VARCHAR" property="strategyCode" />
    <result column="STRATEGY_NAME" jdbcType="VARCHAR" property="strategyName" />
    <result column="TRN_TYPE" jdbcType="CHAR" property="trnType" />
    <result column="CHANNEL" jdbcType="CHAR" property="channel" />
    <result column="STRATEGY_ACTION" jdbcType="CHAR" property="strategyAction" />
    <result column="POST_ACTION" jdbcType="VARCHAR" property="postAction" />
    <result column="AGENT_BORE" jdbcType="VARCHAR" property="agentBore" />
    <result column="PRIORITY" jdbcType="VARCHAR" property="priority" />
    <result column="WARN_LEVEL" jdbcType="VARCHAR" property="warnLevel" />
    <result column="REMARK" jdbcType="VARCHAR" property="remark" />
    <result column="VERSION" jdbcType="INTEGER" property="version" />
    <result column="RUNING_STATUS" jdbcType="CHAR" property="runningStatus" />
    <result column="AB" jdbcType="CHAR" property="ab" />
    <result column="TRAINNING_START_TIME" jdbcType="TIMESTAMP" property="trainningStartTime" />
    <result column="TRAINNING_END_TIME" jdbcType="TIMESTAMP" property="trainningEndTime" />
    <result column="TOTAL_COUNT" jdbcType="INTEGER" property="totalCount" />
    <result column="HIT_COUNT" jdbcType="INTEGER" property="hitCount" />
    <result column="HIT_COUNT_A" jdbcType="INTEGER" property="hitCountA" />
    <result column="CREATE_DATE" jdbcType="VARCHAR" property="createDate" />
    <result column="CREATE_TIME" jdbcType="VARCHAR" property="createTime" />
    <result column="CREATE_USER" jdbcType="VARCHAR" property="createUser" />
    <result column="UPDATE_DATE" jdbcType="VARCHAR" property="updateDate" />
    <result column="UPDATE_TIME" jdbcType="VARCHAR" property="updateTime" />
    <result column="UPDATE_USER" jdbcType="VARCHAR" property="updateUser" />
    <result column="TIME_STAMP" jdbcType="TIMESTAMP" property="timeStamp" />
    <result column="REC_STAT" jdbcType="VARCHAR" property="recStat" />
    <result column="RULE_CONTENT" jdbcType="VARCHAR" property="ruleContent" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from sys_rule_strategy
    where STRATEGY_ID = #{strategyId,jdbcType=CHAR}
  </delete>
  <insert id="insert" parameterType="cn.com.zsyk.crm.manage.entity.SysRuleStrategy">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into sys_rule_strategy (STRATEGY_ID, STRATEGY_CODE, STRATEGY_NAME, 
      TRN_TYPE, CHANNEL, STRATEGY_ACTION, 
      POST_ACTION, AGENT_BORE, PRIORITY, 
      WARN_LEVEL, remark, version, 
      running_status, ab, trainning_start_time, 
      trainning_end_time, total_count, hit_count, 
      hit_count_a, create_date, create_time, 
      create_user, update_date, update_time, 
      update_user, time_stamp, rec_stat, 
      RULE_CONTENT)
    values (#{strategyId,jdbcType=CHAR}, #{strategyCode,jdbcType=VARCHAR}, #{strategyName,jdbcType=VARCHAR}, 
      #{trnType,jdbcType=CHAR}, #{channel,jdbcType=CHAR}, #{strategyAction,jdbcType=CHAR}, 
      #{postAction,jdbcType=VARCHAR}, #{agentBore,jdbcType=VARCHAR}, #{priority,jdbcType=VARCHAR}, 
      #{warnLevel,jdbcType=VARCHAR}, #{remark,jdbcType=VARCHAR}, #{version,jdbcType=INTEGER}, 
      #{runningStatus,jdbcType=CHAR}, #{ab,jdbcType=CHAR}, #{trainningStartTime,jdbcType=TIMESTAMP}, 
      #{trainningEndTime,jdbcType=TIMESTAMP}, #{totalCount,jdbcType=INTEGER}, #{hitCount,jdbcType=INTEGER}, 
      #{hitCountA,jdbcType=INTEGER}, #{createDate,jdbcType=VARCHAR}, #{createTime,jdbcType=VARCHAR}, 
      #{createUser,jdbcType=VARCHAR}, #{updateDate,jdbcType=VARCHAR}, #{updateTime,jdbcType=VARCHAR}, 
      #{updateUser,jdbcType=VARCHAR}, #{timeStamp,jdbcType=TIMESTAMP}, #{recStat,jdbcType=VARCHAR}, 
      #{ruleContent,jdbcType=LONGVARCHAR})
  </insert>
  <update id="updateByPrimaryKey" parameterType="cn.com.zsyk.crm.manage.entity.SysRuleStrategy">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update sys_rule_strategy
    set STRATEGY_CODE = #{strategyCode,jdbcType=VARCHAR},
      STRATEGY_NAME = #{strategyName,jdbcType=VARCHAR},
      TRN_TYPE = #{trnType,jdbcType=CHAR},
      CHANNEL = #{channel,jdbcType=CHAR},
      STRATEGY_ACTION = #{strategyAction,jdbcType=CHAR},
      POST_ACTION = #{postAction,jdbcType=VARCHAR},
      AGENT_BORE = #{agentBore,jdbcType=VARCHAR},
      PRIORITY = #{priority,jdbcType=VARCHAR},
      WARN_LEVEL = #{warnLevel,jdbcType=VARCHAR},
      remark = #{remark,jdbcType=VARCHAR},
      version = #{version,jdbcType=INTEGER},
      running_status = #{runningStatus,jdbcType=CHAR},
      ab = #{ab,jdbcType=CHAR},
      trainning_start_time = #{trainningStartTime,jdbcType=TIMESTAMP},
      trainning_end_time = #{trainningEndTime,jdbcType=TIMESTAMP},
      total_count = #{totalCount,jdbcType=INTEGER},
      hit_count = #{hitCount,jdbcType=INTEGER},
      hit_count_a = #{hitCountA,jdbcType=INTEGER},
      create_date = #{createDate,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=VARCHAR},
      create_user = #{createUser,jdbcType=VARCHAR},
      update_date = #{updateDate,jdbcType=VARCHAR},
      update_time = #{updateTime,jdbcType=VARCHAR},
      update_user = #{updateUser,jdbcType=VARCHAR},
      time_stamp = #{timeStamp,jdbcType=TIMESTAMP},
      rec_stat = #{recStat,jdbcType=VARCHAR},
      RULE_CONTENT = #{ruleContent,jdbcType=LONGVARCHAR}
    where STRATEGY_ID = #{strategyId,jdbcType=CHAR}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select STRATEGY_ID, STRATEGY_CODE, STRATEGY_NAME, TRN_TYPE, CHANNEL, STRATEGY_ACTION, 
    POST_ACTION, AGENT_BORE, PRIORITY, WARN_LEVEL, remark, version, running_status, ab, 
    trainning_start_time, trainning_end_time, total_count, hit_count, hit_count_a, create_date, 
    create_time, create_user, update_date, update_time, update_user, time_stamp, rec_stat,
    utl_raw.cast_to_varchar2(RULE_CONTENT) RULE_CONTENT
    from sys_rule_strategy
    where STRATEGY_ID = #{strategyId,jdbcType=CHAR}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select strategy_id, strategy_code, strategy_name, trn_type, channel, strategy_action, 
    post_action, agent_bore, priority, warn_level, remark, version, rule_content, running_status, ab,
    trainning_start_time, trainning_end_time, total_count, hit_count, hit_count_a, create_date, 
    create_time, create_user, update_date, update_time, update_user, time_stamp, rec_stat
    from sys_rule_strategy
  </select>
   <!--获取所有规则-->
  <select id="getAllRules" parameterType="string" resultType="java.util.Map">
    SELECT t1.scene_code,t2.strategy_id,t3.strategy_name,t3.rule_content,t3.strategy_action,t3.post_action,t3.priority,t3.agent_bore
    FROM sys_rule_scene t1,sys_rule_scene_strategy_rel t2,sys_rule_strategy t3
    WHERE
    t1.scene_code = t2.scene_code
    AND t2.strategy_id = t3.strategy_id
    and t3.running_status = #{flag}
  </select>
  
  <select id="findStrategyScenes" parameterType="java.lang.String" resultType="string">
    select scene_code from sys_rule_scene_strategy_rel where strategy_id = #{strategyId}
  </select>
  
   <!--获取模型对应的场景下的所有规则-->
  <select id="getAllRulesByStrategyId" parameterType="map" resultType="java.util.Map">
    SELECT t1.scene_code,t2.strategy_id,t3.strategy_name,t3.rule_content,t3.strategy_action,t3.post_action,t3.priority,t3.agent_bore
    FROM sys_rule_scene t1,sys_rule_scene_strategy_rel t2,sys_rule_strategy t3
    WHERE
    t1.scene_code = t2.scene_code
    AND t2.strategy_id = t3.strategy_id
    AND running_status = #{runningStatus}
    AND t2.strategy_id =  #{strategyId}
  </select>
  
   <!--获取模型对应的场景下的所有规则-->
  <select id="getAllRulesByScene" parameterType="map" resultType="java.util.Map">
    SELECT t1.scene_code,t2.strategy_id,t3.strategy_name,t3.rule_content,t3.strategy_action,t3.post_action,t3.priority,t3.agent_bore
    FROM sys_rule_scene t1,sys_rule_scene_strategy_rel t2,sys_rule_strategy t3
    WHERE t1.scene_code = t2.scene_code 
    AND t2.strategy_id = t3.strategy_id
    AND t3.running_status = #{runningStatus} 
    AND t1.scene_code = #{sceneCode}
  </select>
  
  <select id="selectAllByEntity" resultMap="BaseResultMap" parameterType="cn.com.zsyk.crm.manage.entity.SysRuleStrategy">
    select strategy_id, strategy_code, strategy_name, trn_type, channel, strategy_action,
    post_action, agent_bore, priority, warn_level, remark, version, utl_raw.cast_to_varchar2(RULE_CONTENT) RULE_CONTENT, running_status, ab,
    trainning_start_time, trainning_end_time, total_count, hit_count, hit_count_a, create_date,
    create_time, create_user, update_date, update_time, update_user, time_stamp, rec_stat
    from sys_rule_strategy where 1 = 1
    
    <if test="strategyId != null and strategyId != ''">
        and strategy_id like CONCAT(CONCAT('%',#{strategyId}),'%')
    </if>
    <if test="strategyCode != null and strategyCode != ''">
        and strategy_code like CONCAT(CONCAT('%',#{strategyCode}),'%')
    </if>
    <if test="strategyName != null and strategyName != ''">
        and strategy_name like CONCAT(CONCAT('%',#{strategyName}),'%')
    </if>
    <if test="trnType != null and trnType != ''">
        and trn_type like CONCAT(CONCAT('%',#{trnType}),'%')
    </if>
    <if test="channel != null and channel != ''">
        and channel like CONCAT(CONCAT('%',#{channel}),'%')
    </if>
    <if test="strategyAction != null and strategyAction != ''">
        and strategy_action like CONCAT(CONCAT('%',#{strategyAction}),'%')
    </if>
    <if test="postAction != null and postAction != ''">
        and post_action like CONCAT(CONCAT('%',#{postAction}),'%')
    </if>
    <if test="agentBore != null and agentBore != ''">
        and agent_bore like CONCAT(CONCAT('%',#{agentBore}),'%')
    </if>
    <if test="priority != null and priority != ''">
        and priority like CONCAT(CONCAT('%',#{priority}),'%')
    </if>
    <if test="warnLevel != null and warnLevel != ''">
        and warn_level like CONCAT(CONCAT('%',#{warnLevel}),'%')
    </if>
    <if test="remark != null and remark != ''">
        and remark like CONCAT(CONCAT('%',#{remark}),'%')
    </if>
    <if test="version != null and version != ''">
        and version like CONCAT(CONCAT('%',#{version}),'%')
    </if>
    <if test="runningStatus != null and runningStatus != ''">
        and running_status like CONCAT(CONCAT('%',#{runningStatus}),'%')
    </if>
    <if test="ab != null and ab != ''">
        and ab like CONCAT(CONCAT('%',#{ab}),'%')
    </if>
    <if test="ruleContent != null and ruleContent != ''">
        and rule_content like CONCAT(CONCAT('%',#{ruleContent}),'%')
    </if>
  </select>

  <select id="findStrategysByCombineRuleId" resultMap="BaseResultMap" parameterType="java.lang.String">
    SELECT
      utl_raw.cast_to_varchar2(t1.RULE_CONTENT) RULE_CONTENT,t1.STRATEGY_ID,t1.STRATEGY_CODE,t1.STRATEGY_NAME,t1.TRN_TYPE,t1.CHANNEL,t1.STRATEGY_ACTION,t1.POST_ACTION,t1.AGENT_BORE,t1.PRIORITY,t1.WARN_LEVEL,t1.REMARK,t1.VERSION,t1.RUNNING_STATUS,t1.AB,t1.TRAINNING_START_TIME,t1.TRAINNING_END_TIME,t1.TOTAL_COUNT,t1.HIT_COUNT,t1.HIT_COUNT_A,t1.CREATE_DATE,t1.CREATE_TIME,t1.CREATE_USER,t1.UPDATE_DATE,t1.UPDATE_TIME,t1.UPDATE_USER,t1.TIME_STAMP,t1.REC_STAT
    FROM sys_rule_strategy t1,sys_rule_strategy_combine_rel t2
    WHERE t1.strategy_id = t2.strategy_id
          and t1.rec_stat = '0'
          AND t2.combine_rule_id = #{id}
  </select>
  
  <select id="findStrategyCombineRels" resultType="java.util.Map" parameterType="java.lang.String">
    SELECT t1.strategy_id,t2.combine_rule_id,t2.combine_order,t3.combine_rule_name,utl_raw.cast_to_varchar2(t3.combine_expression) combine_expression,utl_raw.cast_to_varchar2(t3.remark) remark,t3.create_user,t1.strategy_name
    FROM sys_rule_strategy t1
    LEFT JOIN sys_rule_strategy_combine_rel t2
    ON t1.strategy_id = t2.strategy_id
    LEFT JOIN sys_rule_combine_rule t3
    ON t2.combine_rule_id = t3.combine_rule_id
    WHERE t1.strategy_id = #{strategyId}
    ORDER BY t2.combine_order
  </select>
  
      <select id="findByName" resultType="int"  parameterType="cn.com.zsyk.crm.manage.entity.SysRuleStrategy">
    select count(0)
    from sys_rule_strategy
    where strategy_name = #{strategyName}
    <if test="strategyId != null and strategyId != ''">
      and strategy_id != #{strategyId}
    </if>
    and rec_stat = '0'
  </select>
  
  
</mapper>