<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.com.zsyk.crm.manage.mapper.SysAppRemindMapper">
	<resultMap id="BaseResultMap" type="cn.com.zsyk.crm.manage.entity.SysAppRemind">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<id column="remind_id" property="remindId" jdbcType="VARCHAR" />
		<result column="send_user" property="sendUser" jdbcType="VARCHAR" />
		<result column="receiv_user" property="receivUser" jdbcType="VARCHAR" />
		<result column="send_time" property="sendTime" jdbcType="TIMESTAMP" />
		<result column="remind_title" property="remindTitle" jdbcType="VARCHAR" />
		<result column="remind_content" property="remindContent" jdbcType="VARCHAR" />
		<result column="is_read" property="isRead" jdbcType="VARCHAR" />
		<result column="remind_level" property="remindLevel" jdbcType="VARCHAR" />
		<result column="remind_type" property="remindType" jdbcType="VARCHAR" />
		<result column="remind_stat" property="remindStat" jdbcType="VARCHAR" />
		<result column="create_date" property="createDate" jdbcType="VARCHAR" />
		<result column="create_time" property="createTime" jdbcType="VARCHAR" />
		<result column="create_user" property="createUser" jdbcType="VARCHAR" />
		<result column="update_date" property="updateDate" jdbcType="VARCHAR" />
		<result column="update_time" property="updateTime" jdbcType="VARCHAR" />
		<result column="update_user" property="updateUser" jdbcType="VARCHAR" />
		<result column="time_stamp" property="timeStamp" jdbcType="TIMESTAMP" />
		<result column="cust_no" property="custNo" jdbcType="VARCHAR" />
		<result column="cust_name" property="custName" jdbcType="VARCHAR" />
		<result column="event_type" property="eventType" jdbcType="VARCHAR" />
		<result column="event_date" property="eventDate" jdbcType="VARCHAR" />
		<result column="policy_no" property="policyNo" jdbcType="VARCHAR" />
		<result column="end_date" property="endDate" jdbcType="VARCHAR" />
		<result column="mobile" property="mobile" jdbcType="VARCHAR" />
	</resultMap>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.String">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		delete from sys_app_remind
		where remind_id = #{remindId,jdbcType=VARCHAR}
	</delete>
	<insert id="insert" parameterType="cn.com.zsyk.crm.manage.entity.SysAppRemind">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		insert into sys_app_remind (remind_id, send_user, receiv_user,
		send_time, remind_title, remind_content,
		is_read, remind_level, remind_type,
		remind_stat, create_date, create_time,
		create_user, update_date, update_time,
		update_user, time_stamp)
		values (#{remindId,jdbcType=VARCHAR}, #{sendUser,jdbcType=VARCHAR},
		#{receivUser,jdbcType=VARCHAR},
		#{sendTime,jdbcType=TIMESTAMP}, #{remindTitle,jdbcType=VARCHAR}, #{remindContent,jdbcType=VARCHAR},
		#{isRead,jdbcType=VARCHAR}, #{remindLevel,jdbcType=VARCHAR},
		#{remindType,jdbcType=VARCHAR},
		#{remindStat,jdbcType=VARCHAR}, #{createDate,jdbcType=VARCHAR}, #{createTime,jdbcType=VARCHAR},
		#{createUser,jdbcType=VARCHAR}, #{updateDate,jdbcType=VARCHAR},
		#{updateTime,jdbcType=VARCHAR},
		#{updateUser,jdbcType=VARCHAR}, #{timeStamp,jdbcType=TIMESTAMP})
	</insert>
	<update id="updateByPrimaryKey" parameterType="cn.com.zsyk.crm.manage.entity.SysAppRemind">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update sys_app_remind
		set send_user = #{sendUser,jdbcType=VARCHAR},
		receiv_user = #{receivUser,jdbcType=VARCHAR},
		send_time = #{sendTime,jdbcType=TIMESTAMP},
		remind_title = #{remindTitle,jdbcType=VARCHAR},
		remind_content = #{remindContent,jdbcType=VARCHAR},
		is_read = #{isRead,jdbcType=VARCHAR},
		remind_level = #{remindLevel,jdbcType=VARCHAR},
		remind_type = #{remindType,jdbcType=VARCHAR},
		remind_stat = #{remindStat,jdbcType=VARCHAR},
		create_date = #{createDate,jdbcType=VARCHAR},
		create_time = #{createTime,jdbcType=VARCHAR},
		create_user = #{createUser,jdbcType=VARCHAR},
		update_date = #{updateDate,jdbcType=VARCHAR},
		update_time = #{updateTime,jdbcType=VARCHAR},
		update_user = #{updateUser,jdbcType=VARCHAR},
		time_stamp = #{timeStamp,jdbcType=TIMESTAMP}
		where remind_id = #{remindId,jdbcType=VARCHAR}
	</update>
	<select id="selectByPrimaryKey" resultMap="BaseResultMap"
		parameterType="java.lang.String">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		select remind_id, send_user, receiv_user, send_time, remind_title,
		remind_content,
		is_read, remind_level, remind_type, remind_stat, create_date, create_time,
		create_user,
		update_date, update_time, update_user, time_stamp
		from sys_app_remind
		where remind_id = #{remindId,jdbcType=VARCHAR}
	</select>
	<select id="selectAll" resultMap="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		select remind_id, send_user, receiv_user, send_time, remind_title,
		remind_content,
		is_read, remind_level, remind_type, remind_stat, create_date, create_time,
		create_user,
		update_date, update_time, update_user, time_stamp
		from sys_app_remind
	</select>
	<!-- 根据条件查询站内提醒 -->
	<select id="selectByEntity" parameterType="cn.com.zsyk.crm.manage.entity.SysAppRemind" resultMap="BaseResultMap">
		select remind_id, send_user, receiv_user, send_time, remind_title,
		remind_content,
		is_read, remind_level, remind_type, remind_stat
		from sys_app_remind
		where 1=1
		<if test="isRead != null and isRead != '' ">
			and is_read = #{isRead}
		</if>
		<if test="remindTitle != null and remindTitle != '' ">
			and remind_title like CONCAT(CONCAT('%',#{remindTitle,jdbcType=VARCHAR}),'%')
		</if>
		<if test="receivUser != null and receivUser != '' ">
			and receiv_user = #{receivUser}
		</if>
		order by send_time desc,remind_level asc
	</select>
	<!-- 根据条件查询站内提醒 -->
	<select id="selectTop10ByEntity" parameterType="cn.com.zsyk.crm.manage.entity.SysAppRemind" resultMap="BaseResultMap">
		select remind_id, send_user, receiv_user, send_time, remind_title,
		remind_content,
		is_read, remind_level, remind_type, remind_stat
		from sys_app_remind
		where 1=1
		and receiv_user=#{receivUser,jdbcType=VARCHAR}
		<if test="remindId != null and remindId != '' ">
			and remind_id = #{remindId}
		</if>
		and is_read ='0'
		order by send_time desc,remind_level asc limit 0,10
	</select>
	<!-- 更新消息的已读未读状态 -->
	<update id="updateIsReadStat" parameterType="map">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update sys_app_remind
		set 
		is_read = #{isRead,jdbcType=VARCHAR}
		where remind_id = #{remindId,jdbcType=VARCHAR}
	</update>
	<!-- 批量更新消息的已读未读状态 -->
	<update id="batchUpdateIsReadStat" parameterType="map">
		<!-- WARNING - @mbggenerated This element is automatically generated by
			MyBatis Generator, do not modify. -->
		update sys_app_remind
		set
		is_read = #{isRead,jdbcType=VARCHAR}
		<where>
			is_read = '0'
			<if test="receivUser != null and receivUser != ''">
				and receiv_user = #{receivUser}
			</if>
		</where>
	</update>

	<insert id="insertSysAppRemind" parameterType="cn.com.zsyk.crm.manage.entity.SysAppRemind" >
		INSERT INTO sys_app_Remind
		(remind_id,
		send_user,
		receiv_user,
		remind_title,
		remind_content,
		is_read,
		create_date,
		create_time,
		create_user,
		time_stamp,
		rec_stat,
		send_Time,
		cust_no,
		cust_name,
		event_type,
		event_date,
		policy_no,
        end_date,
		mobile)
		VALUES
		(#{remindId},
		#{sendUser},
		#{receivUser},
		#{remindTitle},
		#{remindContent},
		#{isRead},
		#{createDate},
		#{createTime},
		#{createUser},
		sysdate,
		#{recStat},
		sysdate,
		#{custNo},
		#{custName},
		#{eventType},
		#{eventDate},
		#{policyNo,jdbcType=VARCHAR},
		#{endDate,jdbcType=VARCHAR},
		#{mobile,jdbcType=VARCHAR})
	</insert>
	<!-- 按条件查询所有的续保提醒列表 -->
	<select id="selectAllRenwalByUser" parameterType="cn.com.zsyk.crm.manage.entity.SysAppRemind" resultMap="BaseResultMap">
		SELECT t.remind_id,
			   t.send_user,
			   t.receiv_user,
			   t.send_time,
			   t.remind_title,
			   t.remind_content,
			   t.is_read,
			   t.remind_level,
			   t.remind_type,
			   t.remind_stat,
			   t.create_date,
			   t.create_time,
			   t.create_user,
			   t.update_date,
			   t.update_time,
			   t.update_user,
			   t.rec_stat,
			   t.time_stamp,
			   t.cust_no,
			   t.cust_name,
			   t.event_type,
			   t.event_date,
			   t.policy_no,
			   substr(t.end_date,1,10) end_date,
			   t.mobile
		FROM sys_app_remind t
		where t.event_type = '6'
			  and t.is_read = '0'
		<if test="receivUser != null and receivUser != ''">
			and t.receiv_user  = #{receivUser}
		</if>
		and (to_date(t.end_date,'yyyy-mm-dd hh24:mi:ss')-sysDate)>0
		order by (to_date(t.end_date,'yyyy-mm-dd hh24:mi:ss')-sysDate) asc
	</select>
	<!-- 按条件查询所有的事件列表客户列表 -->
	<select id="selectAllEventByUser" parameterType="cn.com.zsyk.crm.manage.entity.SysAppRemind" resultMap="BaseResultMap">
		SELECT t1.remind_id,
         t1.send_user,
         t1.receiv_user,
         t1.send_time,
         t1.remind_title,
         t1.remind_content,
         t1.is_read,
         t1.remind_level,
         t1.remind_type,
         t1.remind_stat,
         t1.create_date,
         t1.create_time,
         t1.create_user,
         t1.update_date,
         t1.update_time,
         t1.update_user,
         t1.rec_stat,
         t1.time_stamp,
         t1.cust_no,
         t1.cust_name,
         t2.code_desc event_type,
		 substr(t1.event_date,1,10) event_date,
         t1.policy_no,
         t1.end_date,
         t1.mobile
    FROM sys_app_remind t1,sys_code_mng t2
    where is_read = '0' and  t1.event_type = t2.code_val
    and t2.type_desc='事件类型'
	<if test="receivUser != null and receivUser != ''">
		and t1.receiv_user = #{receivUser}
	</if>
		order by t1.send_time desc
	</select>
</mapper>