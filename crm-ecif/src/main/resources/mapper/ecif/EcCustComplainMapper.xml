<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.zsyk.crm.ecif.mapper.EcCustComplainMapper">
  <resultMap id="BaseResultMap" type="cn.com.zsyk.crm.ecif.entity.EcCustComplain">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="complain_no" jdbcType="VARCHAR" property="complainNo" />
    <id column="cust_no" jdbcType="VARCHAR" property="custNo" />
    <id column="case_no" jdbcType="VARCHAR" property="caseNo" />
    <result column="case_typ" jdbcType="VARCHAR" property="caseTyp" />
    <result column="case_regi_date" jdbcType="VARCHAR" property="caseRegiDate" />
    <result column="case_sts" jdbcType="VARCHAR" property="caseSts" />
    <result column="transf_order_no" jdbcType="VARCHAR" property="transfOrderNo" />
    <result column="complain_dets" jdbcType="VARCHAR" property="complainDets" />
    <result column="agent_no" jdbcType="VARCHAR" property="agentNo" />
    <result column="complain_typ" jdbcType="VARCHAR" property="complainTyp" />
    <result column="complain_date" jdbcType="VARCHAR" property="complainDate" />
    <result column="complain_sts" jdbcType="VARCHAR" property="complainSts" />
    <result column="remind_flg" jdbcType="VARCHAR" property="remindFlg" />
    <result column="create_date" jdbcType="VARCHAR" property="createDate" />
    <result column="create_time" jdbcType="VARCHAR" property="createTime" />
    <result column="create_user" jdbcType="VARCHAR" property="createUser" />
    <result column="update_date" jdbcType="VARCHAR" property="updateDate" />
    <result column="update_time" jdbcType="VARCHAR" property="updateTime" />
    <result column="update_user" jdbcType="VARCHAR" property="updateUser" />
    <result column="time_stamp" jdbcType="TIMESTAMP" property="timeStamp" />
    <result column="rec_stat" jdbcType="VARCHAR" property="recStat" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="map">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from ec_cust_complain
    where complain_no = #{complainNo,jdbcType=VARCHAR}
      and cust_no = #{custNo,jdbcType=VARCHAR}
      and case_no = #{caseNo,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="cn.com.zsyk.crm.ecif.entity.EcCustComplain">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into ec_cust_complain (complain_no, cust_no, case_no, 
      case_typ, case_regi_date, case_sts, 
      transf_order_no, complain_dets, agent_no, 
      complain_typ, complain_date, complain_sts, remind_flg,
      create_date, create_time, create_user, 
      update_date, update_time, update_user, 
      time_stamp, rec_stat)
    values (#{complainNo,jdbcType=VARCHAR}, #{custNo,jdbcType=VARCHAR}, #{caseNo,jdbcType=VARCHAR}, 
      #{caseTyp,jdbcType=VARCHAR}, #{caseRegiDate,jdbcType=VARCHAR}, #{caseSts,jdbcType=VARCHAR}, 
      #{transfOrderNo,jdbcType=VARCHAR}, #{complainDets,jdbcType=VARCHAR}, #{agentNo,jdbcType=VARCHAR}, 
      #{complainTyp,jdbcType=VARCHAR}, #{complainDate,jdbcType=VARCHAR}, #{complainSts,jdbcType=VARCHAR}, #{remindFlg,jdbcType=VARCHAR},
      #{createDate,jdbcType=VARCHAR}, #{createTime,jdbcType=VARCHAR}, #{createUser,jdbcType=VARCHAR}, 
      #{updateDate,jdbcType=VARCHAR}, #{updateTime,jdbcType=VARCHAR}, #{updateUser,jdbcType=VARCHAR}, 
      #{timeStamp,jdbcType=TIMESTAMP}, #{recStat,jdbcType=VARCHAR})
  </insert>
  <update id="updateByPrimaryKey" parameterType="cn.com.zsyk.crm.ecif.entity.EcCustComplain">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update ec_cust_complain
    set case_typ = #{caseTyp,jdbcType=VARCHAR},
      case_regi_date = #{caseRegiDate,jdbcType=VARCHAR},
      case_sts = #{caseSts,jdbcType=VARCHAR},
      transf_order_no = #{transfOrderNo,jdbcType=VARCHAR},
      complain_dets = #{complainDets,jdbcType=VARCHAR},
      agent_no = #{agentNo,jdbcType=VARCHAR},
      complain_typ = #{complainTyp,jdbcType=VARCHAR},
      complain_date = #{complainDate,jdbcType=VARCHAR},
      complain_sts = #{complainSts,jdbcType=VARCHAR},
      remind_flg = #{remindFlg,jdbcType=VARCHAR},
      create_date = #{createDate,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=VARCHAR},
      create_user = #{createUser,jdbcType=VARCHAR},
      update_date = #{updateDate,jdbcType=VARCHAR},
      update_time = #{updateTime,jdbcType=VARCHAR},
      update_user = #{updateUser,jdbcType=VARCHAR},
      time_stamp = #{timeStamp,jdbcType=TIMESTAMP},
      rec_stat = #{recStat,jdbcType=VARCHAR}
    where complain_no = #{complainNo,jdbcType=VARCHAR}
      and cust_no = #{custNo,jdbcType=VARCHAR}
      and case_no = #{caseNo,jdbcType=VARCHAR}
  </update>
  <select id="selectByPrimaryKey" parameterType="map" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select complain_no, cust_no, case_no, case_typ, case_regi_date, case_sts, transf_order_no, 
    complain_dets, agent_no, complain_typ, complain_date, complain_sts,remind_flg, create_date, 
    create_time, create_user, update_date, update_time, update_user, time_stamp, rec_stat
    from ec_cust_complain
    where complain_no = #{complainNo,jdbcType=VARCHAR}
      and cust_no = #{custNo,jdbcType=VARCHAR}
      and case_no = #{caseNo,jdbcType=VARCHAR}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select complain_no, cust_no, case_no, case_typ, case_regi_date, case_sts, transf_order_no, 
    complain_dets, agent_no, complain_typ, complain_date, complain_sts, remind_flg, create_date, 
    create_time, create_user, update_date, update_time, update_user, time_stamp, rec_stat
    from ec_cust_complain
  </select>
  <select id="selectCustComplainList" parameterType="cn.com.zsyk.crm.ecif.entity.EcCustComplain" resultMap="BaseResultMap">
    select complain_no, cust_no, case_no, case_typ, case_regi_date, case_sts, transf_order_no, 
	    complain_dets, agent_no, complain_typ, complain_date, complain_sts, remind_flg, create_date, 
	    create_time, create_user, update_date, update_time, update_user, time_stamp, rec_stat
    from ec_cust_complain
    where cust_no = #{custNo,jdbcType=VARCHAR} and rec_stat = '0'
			<if test="complainNo != null and complainNo !=''">
				and concat(complain_no,case_no) like concat('%', #{complainNo,jdbcType=VARCHAR}, '%') 
			</if>
			<if test="agentNo != null and agentNo !=''">
				and agent_no = #{agentNo,jdbcType=VARCHAR}
			</if>
  </select>
  <delete id="deleteByCustNo"  parameterType="java.lang.String">
    delete from ec_cust_complain
    where cust_no = #{custNo,jdbcType=VARCHAR}
  </delete>

  <!-- 获取所有未解决且未提醒的客户投诉信息 -->
  <select id="selectUnsolved" resultMap="BaseResultMap">
    select complain_no, cust_no, case_no, case_typ, case_regi_date, case_sts, transf_order_no, 
    complain_dets, agent_no, complain_typ, complain_date, complain_sts, remind_flg, create_date, 
    create_time, create_user, update_date, update_time, update_user, time_stamp, rec_stat
    from ec_cust_complain
    where remind_flg = '0'
    and complain_sts = '0'
  </select>
  <!-- 更新客户投诉信息的提醒状态 -->
  <select id="updateRemindFlg" parameterType="map">
    update ec_cust_complain
    set remind_flg = #{remindFlg}
    where 1=1
    and complain_no = #{complainNo}
    and cust_no = #{custNo}
	and case_no = #{caseNo}
  </select>
</mapper>